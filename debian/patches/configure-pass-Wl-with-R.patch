Description: Always pass -Wl,-Rxyz rather than just -Rxyz
 gcc used to return 0 on unknown flags, but now returns an error.  So
 test compilations fail because we are passing -R/lib.
Author: Serge Hallyn <serge.hallyn@ubuntu.com>
Origin: serge.hallyn@ubuntu.com
Forwarded: no
Last-Update: 2011-06-08

--- ipsec-tools-0.8.0.orig/configure
+++ ipsec-tools-0.8.0/configure
@@ -13076,7 +13076,7 @@ fi
 			as_fn_error $? "ICONV libs or includes not found. Aborting." "$LINENO" 5
 	  	fi
 	fi
-	LIBS="$LIBS -L$libiconv_dir/lib -R$libiconv_dir/lib -liconv"
+	LIBS="$LIBS -L$libiconv_dir/lib -Wl,-R$libiconv_dir/lib -liconv"
 	for ac_func in iconv_open
 do :
   ac_fn_c_check_func "$LINENO" "iconv_open" "ac_cv_func_iconv_open"
@@ -13333,7 +13333,7 @@ fi
 
 $as_echo "#define HAVE_LIBRADIUS /**/" >>confdefs.h
 
-	LIBS="$LIBS -L$libradius_dir/lib -R$libradius_dir/lib -lradius"
+	LIBS="$LIBS -L$libradius_dir/lib -Wl,-R$libradius_dir/lib -lradius"
 	for ac_func in rad_create_request
 do :
   ac_fn_c_check_func "$LINENO" "rad_create_request" "ac_cv_func_rad_create_request"
@@ -13536,7 +13536,7 @@ fi
 
 $as_echo "#define HAVE_LIBPAM /**/" >>confdefs.h
 
-	LIBS="$LIBS -L$libpam_dir/lib -R$libpam_dir/lib -lpam"
+	LIBS="$LIBS -L$libpam_dir/lib -Wl,-R$libpam_dir/lib -lpam"
 	for ac_func in pam_start
 do :
   ac_fn_c_check_func "$LINENO" "pam_start" "ac_cv_func_pam_start"
@@ -13739,7 +13739,7 @@ fi
 
 $as_echo "#define HAVE_LIBLDAP /**/" >>confdefs.h
 
-	LIBS="$LIBS -L$libldap_dir/lib -R$libldap_dir/lib -lldap"
+	LIBS="$LIBS -L$libldap_dir/lib -Wl,-R$libldap_dir/lib -lldap"
 
 	saved_CFLAGS=$CFLAGS
 	CFLAGS="$CFLAGS -Wall -Werror"
--- ipsec-tools-0.8.0.orig/configure.ac
+++ ipsec-tools-0.8.0/configure.ac
@@ -318,7 +318,7 @@ if test "$libiconv_dir" != "no"; then
 			AC_MSG_ERROR([ICONV libs or includes not found. Aborting.])
 	  	fi
 	fi
-	LIBS="$LIBS -L$libiconv_dir/lib -R$libiconv_dir/lib -liconv"
+	LIBS="$LIBS -L$libiconv_dir/lib -Wl,-R$libiconv_dir/lib -liconv"
 	AC_CHECK_FUNCS(iconv_open)
 fi
 
@@ -382,7 +382,7 @@ if test "$libradius_dir" != "no"; then
 	  	fi
 	fi
 	AC_DEFINE([HAVE_LIBRADIUS], [], [Hybrid authentication uses RADIUS])
-	LIBS="$LIBS -L$libradius_dir/lib -R$libradius_dir/lib -lradius"
+	LIBS="$LIBS -L$libradius_dir/lib -Wl,-R$libradius_dir/lib -lradius"
 	AC_CHECK_FUNCS(rad_create_request)
 fi
 
@@ -408,7 +408,7 @@ if test "$libpam_dir" != "no"; then
 	  	fi
 	fi
 	AC_DEFINE([HAVE_LIBPAM], [], [Hybrid authentication uses PAM])
-	LIBS="$LIBS -L$libpam_dir/lib -R$libpam_dir/lib -lpam"
+	LIBS="$LIBS -L$libpam_dir/lib -Wl,-R$libpam_dir/lib -lpam"
 	AC_CHECK_FUNCS(pam_start)
 fi
 
@@ -434,7 +434,7 @@ if test "$libldap_dir" != "no"; then
 	  	fi
 	fi
 	AC_DEFINE([HAVE_LIBLDAP], [], [Hybrid authentication uses LDAP])
-	LIBS="$LIBS -L$libldap_dir/lib -R$libldap_dir/lib -lldap"
+	LIBS="$LIBS -L$libldap_dir/lib -Wl,-R$libldap_dir/lib -lldap"
 
 	saved_CFLAGS=$CFLAGS
 	CFLAGS="$CFLAGS -Wall -Werror"
--- ipsec-tools-0.8.0.orig/aclocal.m4
+++ ipsec-tools-0.8.0/aclocal.m4
@@ -5994,7 +5994,7 @@ if test "$_lt_caught_CXX_error" != yes;
 	      _LT_TAGVAR(no_undefined_flag, $1)=' -zdefs'
 	      _LT_TAGVAR(archive_cmds, $1)='$CC -G${allow_undefined_flag} -h$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
 	      _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -G${allow_undefined_flag} -h$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-retain-symbols-file ${wl}$export_symbols'
-	      _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-R$libdir'
+	      _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-Wl,-R$libdir'
 	      _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive`new_convenience=; for conv in $convenience\"\"; do test -z \"$conv\" || new_convenience=\"$new_convenience,$conv\"; done; $ECHO \"$new_convenience\"` ${wl}--no-whole-archive'
 	      _LT_TAGVAR(compiler_needs_object, $1)=yes
 
@@ -6247,7 +6247,7 @@ if test "$_lt_caught_CXX_error" != yes;
 	        output_verbose_link_cmd='$CC -G $CFLAGS -v conftest.$objext 2>&1 | $GREP "\-L"'
 	      fi
 
-	      _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-R $wl$libdir'
+	      _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-Wl,-R $wl$libdir'
 	      case $host_os in
 		solaris2.[[0-5]] | solaris2.[[0-5]].*) ;;
 		*)
